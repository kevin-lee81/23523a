<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>맞춤 제작 주문 시스템</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            padding: 40px;
            color: white;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .content {
            padding: 40px;
        }

        .form-section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }

        .upload-area.dragging {
            border-color: #00d2ff;
            background: rgba(0, 210, 255, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .file-list {
            background: white;
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .price-display {
            background: linear-gradient(45deg, #00d2ff, #3a7bd5);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .price-display h3 {
            margin-bottom: 10px;
        }

        .price-amount {
            font-size: 2rem;
            font-weight: bold;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d1edff;
            color: #0c5460;
            border: 1px solid #b6effb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .progress {
            width: 100%;
            height: 15px;
            background: #e9ecef;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00d2ff, #3a7bd5);
            width: 0%;
            transition: width 0.3s;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-group.full-width {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎨 맞춤 제작 주문</h1>
            <p>당신만의 특별한 제품을 만들어보세요</p>
        </div>

        <div class="content">
            <div id="alerts"></div>
            
            <form id="order-form">
                <!-- 제품 사양 섹션 -->
                <div class="form-section">
                    <div class="section-title">
                        📐 제품 사양
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>📏 사이즈</label>
                            <select id="size" onchange="calculatePrice()" required>
                                <option value="">사이즈 선택</option>
                                <option value="small" data-price="10000">소형 (10cm x 10cm) - 10,000원</option>
                                <option value="medium" data-price="20000">중형 (20cm x 20cm) - 20,000원</option>
                                <option value="large" data-price="30000">대형 (30cm x 30cm) - 30,000원</option>
                                <option value="custom" data-price="0">맞춤 사이즈 (별도 문의)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>🎯 재질</label>
                            <select id="material" onchange="calculatePrice()" required>
                                <option value="">재질 선택</option>
                                <option value="wood" data-price="5000">원목 (+5,000원)</option>
                                <option value="acrylic" data-price="3000">아크릴 (+3,000원)</option>
                                <option value="metal" data-price="8000">금속 (+8,000원)</option>
                                <option value="fabric" data-price="2000">패브릭 (+2,000원)</option>
                                <option value="plastic" data-price="1000">플라스틱 (+1,000원)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>🔢 수량</label>
                            <select id="quantity" onchange="calculatePrice()" required>
                                <option value="">수량 선택</option>
                                <option value="1">1개</option>
                                <option value="2">2개</option>
                                <option value="3">3개</option>
                                <option value="5">5개</option>
                                <option value="10">10개</option>
                                <option value="custom">기타 (직접 입력)</option>
                            </select>
                        </div>

                        <div class="form-group" id="custom-quantity-group" style="display: none;">
                            <label>직접 입력 수량</label>
                            <input type="number" id="custom-quantity" min="1" max="1000" onchange="calculatePrice()">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>⚡ 작업 옵션</label>
                            <select id="work-option" onchange="calculatePrice()" required>
                                <option value="standard" data-price="0">일반 작업 (7-10일)</option>
                                <option value="premium" data-price="10000">프리미엄 작업 (+10,000원, 5-7일)</option>
                                <option value="rush" data-price="25000">긴급 작업 (+25,000원, 2-3일)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>🎨 색상</label>
                            <select id="color">
                                <option value="">색상 선택 (선택사항)</option>
                                <option value="natural">자연색</option>
                                <option value="black">블랙</option>
                                <option value="white">화이트</option>
                                <option value="red">레드</option>
                                <option value="blue">블루</option>
                                <option value="custom">맞춤 색상 (별도 문의)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 파일 업로드 섹션 -->
                <div class="form-section">
                    <div class="section-title">
                        📁 디자인 파일 업로드
                    </div>
                    
                    <div class="upload-area" onclick="document.getElementById('file-input').click()" 
                         ondragover="handleDragOver(event)" 
                         ondrop="handleDrop(event)" 
                         ondragenter="handleDragEnter(event)" 
                         ondragleave="handleDragLeave(event)">
                        <div class="upload-icon">☁️</div>
                        <h3>디자인 파일을 드래그하거나 클릭하여 업로드</h3>
                        <p>지원 형식: JPG, PNG, PDF, AI, PSD (최대 200MB)</p>
                        <input type="file" id="file-input" style="display: none;" 
                               onchange="handleFileSelect(event)" 
                               multiple 
                               accept=".jpg,.jpeg,.png,.pdf,.ai,.psd">
                    </div>

                    <div id="file-list" class="file-list" style="display: none;">
                        <!-- 선택된 파일들이 여기에 표시됩니다 -->
                    </div>
                </div>

                <!-- 고객 정보 섹션 -->
                <div class="form-section">
                    <div class="section-title">
                        👤 고객 정보
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>📞 연락처</label>
                            <input type="tel" id="contact" placeholder="010-1234-5678" required>
                        </div>

                        <div class="form-group">
                            <label>📧 이메일</label>
                            <input type="email" id="email" placeholder="example@email.com">
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label>📝 특별 요청사항</label>
                        <textarea id="special-request" rows="4" 
                                  placeholder="특별한 요청사항이나 세부 사항을 입력해주세요..."></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label>🚚 배송 주소 (선택사항)</label>
                        <textarea id="address" rows="3" 
                                  placeholder="배송이 필요한 경우 주소를 입력해주세요..."></textarea>
                    </div>
                </div>

                <!-- 가격 표시 -->
                <div class="price-display" id="price-display" style="display: none;">
                    <h3>💰 예상 제작비</h3>
                    <div class="price-amount" id="total-price">0원</div>
                    <p style="margin-top: 10px; font-size: 0.9rem;">* 최종 가격은 디자인 복잡도에 따라 달라질 수 있습니다</p>
                </div>

                <!-- 업로드 진행상황 -->
                <div id="upload-progress" style="display: none;">
                    <div class="progress">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    <p id="progress-text">주문 제출 중... 0%</p>
                </div>

                <!-- 제출 버튼 -->
                <div style="text-align: center; margin-top: 30px;">
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">🔄 초기화</button>
                    <button type="submit" class="btn btn-primary">🚀 주문 제출하기</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let selectedFiles = [];
        let basePrice = 0;
        let materialPrice = 0;
        let rushPrice = 0;
        let totalQuantity = 1;

        // 페이지 로드시 초기화
        window.onload = function() {
            calculatePrice();
        };

        // 수량 선택 변경시
        document.getElementById('quantity').addEventListener('change', function() {
            const customGroup = document.getElementById('custom-quantity-group');
            if (this.value === 'custom') {
                customGroup.style.display = 'block';
            } else {
                customGroup.style.display = 'none';
                totalQuantity = parseInt(this.value) || 1;
            }
            calculatePrice();
        });

        // 맞춤 수량 입력시
        document.getElementById('custom-quantity').addEventListener('input', function() {
            totalQuantity = parseInt(this.value) || 1;
            calculatePrice();
        });

        // 가격 계산
        function calculatePrice() {
            const size = document.getElementById('size');
            const material = document.getElementById('material');
            const workOption = document.getElementById('work-option');
            
            basePrice = parseInt(size.selectedOptions[0]?.dataset?.price || 0);
            materialPrice = parseInt(material.selectedOptions[0]?.dataset?.price || 0);
            rushPrice = parseInt(workOption.selectedOptions[0]?.dataset?.price || 0);
            
            const total = (basePrice + materialPrice + rushPrice) * totalQuantity;
            
            if (total > 0) {
                document.getElementById('price-display').style.display = 'block';
                document.getElementById('total-price').textContent = total.toLocaleString() + '원';
            } else {
                document.getElementById('price-display').style.display = 'none';
            }
        }

        // 파일 선택 처리
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            handleFiles(files);
        }

        function handleFiles(files) {
            selectedFiles = [...selectedFiles, ...files];
            displayFileList();
        }

        function displayFileList() {
            const fileList = document.getElementById('file-list');
            if (selectedFiles.length === 0) {
                fileList.style.display = 'none';
                return;
            }

            fileList.style.display = 'block';
            fileList.innerHTML = selectedFiles.map((file, index) => `
                <div class="file-item">
                    <div>
                        <strong>${file.name}</strong>
                        <small>(${(file.size / 1024 / 1024).toFixed(2)}MB)</small>
                    </div>
                    <button type="button" onclick="removeFile(${index})" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px;">삭제</button>
                </div>
            `).join('');
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            displayFileList();
        }

        // 드래그 앤 드롭 처리
        function handleDragOver(e) { e.preventDefault(); }
        function handleDragEnter(e) { e.preventDefault(); e.target.closest('.upload-area').classList.add('dragging'); }
        function handleDragLeave(e) { e.preventDefault(); e.target.closest('.upload-area').classList.remove('dragging'); }
        function handleDrop(e) {
            e.preventDefault();
            e.target.closest('.upload-area').classList.remove('dragging');
            const files = Array.from(e.dataTransfer.files);
            handleFiles(files);
        }

        // 폼 제출
        document.getElementById('order-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (selectedFiles.length === 0) {
                showAlert('❌ 디자인 파일을 업로드해주세요.', 'error');
                return;
            }

            const formData = {
                size: document.getElementById('size').value,
                material: document.getElementById('material').value,
                quantity: totalQuantity,
                workOption: document.getElementById('work-option').value,
                color: document.getElementById('color').value,
                contact: document.getElementById('contact').value,
                email: document.getElementById('email').value,
                specialRequest: document.getElementById('special-request').value,
                address: document.getElementById('address').value,
                totalPrice: (basePrice + materialPrice + rushPrice) * totalQuantity,
                files: selectedFiles
            };

            await submitOrder(formData);
        });

        // 주문 제출
        async function submitOrder(orderData) {
            document.getElementById('upload-progress').style.display = 'block';
            
            try {
                // TODO: 배포된 Cloudflare Workers URL로 변경하세요
                const workerUrl = 'https://custom-order-system.your-subdomain.workers.dev/upload';
                
                for (let i = 0; i < orderData.files.length; i++) {
                    const file = orderData.files[i];
                    const progress = (i / orderData.files.length) * 100;
                    
                    document.getElementById('progress-bar').style.width = progress + '%';
                    document.getElementById('progress-text').textContent = `업로드 중... ${Math.round(progress)}%`;

                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('orderData', JSON.stringify(orderData));

                    const response = await fetch(workerUrl, {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error('업로드 실패');
                    }
                }

                document.getElementById('progress-bar').style.width = '100%';
                document.getElementById('progress-text').textContent = '주문 완료!';
                
                showAlert('🎉 주문이 성공적으로 제출되었습니다! 곧 연락드리겠습니다.', 'success');
                resetForm();

            } catch (error) {
                showAlert(`❌ 주문 제출 실패: ${error.message}`, 'error');
                document.getElementById('upload-progress').style.display = 'none';
            }
        }

        // 폼 초기화
        function resetForm() {
            document.getElementById('order-form').reset();
            selectedFiles = [];
            displayFileList();
            calculatePrice();
            document.getElementById('upload-progress').style.display = 'none';
        }

        // 알림 표시
        function showAlert(message, type = 'success') {
            const alertsDiv = document.getElementById('alerts');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = message;
            alertsDiv.appendChild(alertDiv);
            
            setTimeout(() => alertDiv.remove(), 5000);
        }
    </script>
</body>
</html>
